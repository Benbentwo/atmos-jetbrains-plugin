<idea-plugin>
    <id>com.cloudposse.atmos</id>
    <name>Atmos</name>
    <vendor email="support@cloudposse.com" url="https://cloudposse.com">Cloud Posse</vendor>

    <description><![CDATA[
        First-class IDE support for <a href="https://atmos.tools/">Atmos</a> -
        the ultimate DevOps framework for Terraform, OpenTofu, Packer, and Helmfile orchestration.

        <h2>Features</h2>
        <ul>
            <li>Syntax highlighting for YAML functions (!env, !exec, !terraform.output, etc.)</li>
            <li>Navigation to imports, components, and variable definitions (Cmd+Click)</li>
            <li>Code completion for imports, components, and variables</li>
            <li>Inspections for missing imports, unknown components, and circular imports</li>
            <li>Gutter icons for inheritance relationships</li>
            <li>Tool window for browsing stacks and components</li>
            <li>Component Inspector for real-time resolved values</li>
            <li>Run configurations for Atmos CLI commands</li>
            <li>Quick Documentation (F1/Ctrl+Q) for Atmos elements</li>
            <li>Context menu actions for common Atmos commands</li>
        </ul>

        <h2>Getting Started</h2>
        <ol>
            <li>Open a project containing an <code>atmos.yaml</code> configuration file</li>
            <li>The plugin will automatically detect the Atmos project</li>
            <li>Navigate stack files with Cmd+Click on imports</li>
            <li>Configure the Atmos executable path in Settings &gt; Tools &gt; Atmos</li>
        </ol>
    ]]></description>

    <!-- Platform dependencies -->
    <depends>com.intellij.modules.platform</depends>
    <depends>org.jetbrains.plugins.yaml</depends>

    <extensions defaultExtensionNs="com.intellij">
        <!-- Application Services -->
        <applicationService
            serviceImplementation="com.cloudposse.atmos.settings.AtmosSettings"/>

        <!-- Project Services -->
        <projectService
            serviceImplementation="com.cloudposse.atmos.services.AtmosProjectService"/>
        <projectService
            serviceImplementation="com.cloudposse.atmos.services.AtmosConfigurationService"/>
        <projectService
            serviceImplementation="com.cloudposse.atmos.services.AtmosCommandRunner"/>

        <!-- Settings UI -->
        <applicationConfigurable
            parentId="tools"
            instance="com.cloudposse.atmos.settings.AtmosSettingsConfigurable"
            id="com.cloudposse.atmos.settings"
            displayName="Atmos"/>

        <!-- Language Support -->
        <annotator
            language="yaml"
            implementationClass="com.cloudposse.atmos.language.yaml.AtmosYamlFunctionAnnotator"/>

        <!-- Navigation -->
        <psi.referenceContributor
            language="yaml"
            implementation="com.cloudposse.atmos.navigation.AtmosImportReferenceContributor"/>
        <psi.referenceContributor
            language="yaml"
            implementation="com.cloudposse.atmos.navigation.AtmosComponentReferenceContributor"/>

        <!-- Code Completion -->
        <completion.contributor
            language="yaml"
            implementationClass="com.cloudposse.atmos.completion.AtmosCompletionContributor"/>

        <!-- Line Markers (Gutter Icons) -->
        <codeInsight.lineMarkerProvider
            language="yaml"
            implementationClass="com.cloudposse.atmos.gutter.AtmosLineMarkerProvider"/>
        <codeInsight.lineMarkerProvider
            language="yaml"
            implementationClass="com.cloudposse.atmos.gutter.AtmosVariableOverrideLineMarkerProvider"/>

        <!-- Inspections -->
        <localInspection
            language="yaml"
            groupName="Atmos"
            shortName="AtmosMissingImport"
            displayName="Missing import file"
            enabledByDefault="true"
            level="ERROR"
            implementationClass="com.cloudposse.atmos.inspections.AtmosMissingImportInspection"/>
        <localInspection
            language="yaml"
            groupName="Atmos"
            shortName="AtmosUnknownComponent"
            displayName="Unknown component"
            enabledByDefault="true"
            level="WARNING"
            implementationClass="com.cloudposse.atmos.inspections.AtmosUnknownComponentInspection"/>
        <localInspection
            language="yaml"
            groupName="Atmos"
            shortName="AtmosCircularImport"
            displayName="Circular import"
            enabledByDefault="true"
            level="ERROR"
            implementationClass="com.cloudposse.atmos.inspections.AtmosCircularImportInspection"/>

        <!-- Documentation -->
        <lang.documentationProvider
            language="yaml"
            implementationClass="com.cloudposse.atmos.documentation.AtmosDocumentationProvider"/>

        <!-- Tool Windows -->
        <toolWindow
            id="Atmos"
            anchor="right"
            icon="com.cloudposse.atmos.AtmosIcons.TOOL_WINDOW"
            factoryClass="com.cloudposse.atmos.toolwindow.AtmosToolWindowFactory"/>
        <toolWindow
            id="Atmos Inspector"
            anchor="right"
            secondary="true"
            icon="com.cloudposse.atmos.AtmosIcons.COMPONENT"
            factoryClass="com.cloudposse.atmos.toolwindow.AtmosInspectorToolWindowFactory"/>

        <!-- Run Configurations -->
        <configurationType
            implementation="com.cloudposse.atmos.cli.AtmosRunConfigurationType"/>
        <configurationType
            implementation="com.cloudposse.atmos.run.AtmosRunConfigurationType"/>

        <!-- Notifications -->
        <notificationGroup
            id="Atmos"
            displayType="BALLOON"/>
    </extensions>

    <actions>
        <!-- Atmos Action Group - combines context menu and tools menu actions -->
        <group id="Atmos.ActionGroup"
               text="Atmos"
               description="Atmos actions"
               popup="true"
               icon="com.cloudposse.atmos.AtmosIcons.ATMOS">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
            <add-to-group group-id="EditorPopupMenu" anchor="last"/>
            <add-to-group group-id="ProjectViewPopupMenu" anchor="last"/>

            <action id="Atmos.DescribeStacks"
                    class="com.cloudposse.atmos.actions.DescribeStacksAction"
                    text="Describe Stacks"
                    description="Run atmos describe stacks"/>

            <action id="Atmos.DescribeStack"
                    class="com.cloudposse.atmos.actions.DescribeStackAction"
                    text="Describe This Stack"
                    description="Run atmos describe stacks for the current file"/>

            <action id="Atmos.DescribeComponent"
                    class="com.cloudposse.atmos.actions.DescribeComponentAction"
                    text="Describe Component..."
                    description="Run atmos describe component"/>

            <action id="Atmos.ValidateComponent"
                    class="com.cloudposse.atmos.actions.ValidateComponentAction"
                    text="Validate Component..."
                    description="Run atmos validate component"/>

            <separator/>

            <action id="Atmos.TerraformPlan"
                    class="com.cloudposse.atmos.actions.TerraformPlanAction"
                    text="Terraform Plan..."
                    description="Run atmos terraform plan"/>

            <action id="Atmos.TerraformApply"
                    class="com.cloudposse.atmos.actions.TerraformApplyAction"
                    text="Terraform Apply..."
                    description="Run atmos terraform apply"/>

            <separator/>

            <action id="Atmos.RunWorkflow"
                    class="com.cloudposse.atmos.actions.RunWorkflowAction"
                    text="Run Workflow..."
                    description="Run atmos workflow"/>

            <action id="Atmos.DescribeAffected"
                    class="com.cloudposse.atmos.actions.DescribeAffectedAction"
                    text="Describe Affected"
                    description="Run atmos describe affected"/>
        </group>
    </actions>
</idea-plugin>
